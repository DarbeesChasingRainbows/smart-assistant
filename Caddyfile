:8000 {
	# 1. Global API Route (Missing Piece)
	# This allows the frontends to reach the backend via http://localhost:8000/api
	handle /api* {
		reverse_proxy api:5120
	}

	# 2. Garage App
	handle /garage* {
		reverse_proxy garage-frontend:8000
	}

	# 3. Flashcards App
	handle /flashcards* {
		reverse_proxy flashcards-frontend:8000
	}

	# 4. Budget App
	handle_path /budget/api/* {
		rewrite * /api{path}
		reverse_proxy api:5120
	}

	handle /budget* {
		reverse_proxy budget-frontend:8000
	}

	# 5. Asset Catch & Rewrite
	handle /assets/* {
		@from_garage header_regexp Referer /garage
		handle @from_garage {
			rewrite * /garage{path}
			reverse_proxy garage-frontend:8000
		}

		@from_flashcards header_regexp Referer /flashcards
		handle @from_flashcards {
			rewrite * /flashcards{path}
			reverse_proxy flashcards-frontend:8000
		}

		@from_budget header_regexp Referer /budget
		handle @from_budget {
			rewrite * /budget{path}
			reverse_proxy budget-frontend:8000
		}

		reverse_proxy frontend:8000
	}

	# 6. Default Root
	handle {
		reverse_proxy frontend:8000
	}
}